<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Form URL Selector</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        label, input, select, p { margin-bottom: 10px; display: block; }
        #urlDisplay { margin-top: 10px; font-weight: bold; color: blue; }
    </style>
</head>
<body>

<h2>Select a Form</h2>

<label for="searchInput">Search for your name:</label>
<input type="text" id="searchInput" placeholder="Type your name..." oninput="filterDropdown()" />

<label for="dropdown">Matching names:</label>
<select id="dropdown" onchange="showURL()">
    <option value="">--Select--</option>
</select>

<div id="urlDisplay" style="display:none;">
    <p>Here is your form URL:</p>
    <a href="#" id="formLink" target="_blank"></a>
</div>

<script>
    const dropdown = document.getElementById("dropdown");
    const formLink = document.getElementById("formLink");
    const urlDisplay = document.getElementById("urlDisplay");
    const searchInput = document.getElementById("searchInput");

    let formEntries = [];
    let formMap = {};

    function getLastFirst(fullName) {
        const parts = fullName.trim().split(" ");
        const last = parts[parts.length - 1].toLowerCase();
        const first = parts.slice(0, -1).join(" ").toLowerCase();
        return { last, first };
    }

    fetch("signInMapping.csv")
        .then(response => response.text())
        .then(text => {
            const rows = text.trim().split("\n");
            const entries = [];

            for (let i = 1; i < rows.length; i++) {
                const [label, url] = rows[i].split(",");
                const { last, first } = getLastFirst(label);
                entries.push({ label, url, last, first });
            }

            // Sort by Last ASC, then First ASC
            entries.sort((a, b) => {
                if (a.last < b.last) return -1;
                if (a.last > b.last) return 1;
                return a.first.localeCompare(b.first);
            });

            formEntries = entries;
            for (const entry of entries) {
                formMap[entry.label] = entry.url;
            }

            populateDropdown(entries);
        });

    function populateDropdown(entries) {
        dropdown.innerHTML = '<option value="">--Select--</option>';
        for (const entry of entries) {
            const option = document.createElement("option");
            option.value = entry.label;
            option.textContent = entry.label;
            dropdown.appendChild(option);
        }
    }

    function filterDropdown() {
        const search = searchInput.value.toLowerCase();
        const filtered = formEntries.filter(entry =>
            entry.label.toLowerCase().includes(search)
        );
        populateDropdown(filtered);
    }

    function showURL() {
        const selected = dropdown.value;
        if (formMap[selected]) {
            formLink.href = formMap[selected];
            formLink.textContent = formMap[selected];
            urlDisplay.style.display = "block";
        } else {
            urlDisplay.style.display = "none";
        }
    }
</script>

</body>
</html>
